# AIminer v1.22-SNAPSHOT 変更レポート

**日付**: 2025-12-02
**バージョン**: 1.21-SNAPSHOT → 1.22-SNAPSHOT

## 概要

ボットの自律行動能力を大幅に強化しました。マルチタスク実行、自動情報取得、自律的な探索・採掘行動が可能になりました。

## 主な変更点

### 1. マルチタスク実行（TaskExecutor）

- 1サイクルで最大3つのタスクを処理
- 失敗したタスクはスキップして次のタスクへ進む
- AI応答待ち（約50秒）の間も並行してタスクを実行

```java
private static final int MAX_TASKS_PER_CYCLE = 3;

for (Task task : pendingTasks) {
    if (processedCount >= MAX_TASKS_PER_CYCLE) break;
    // 実行、失敗しても次へ
}
```

### 2. インベントリ・アイテム自動取得（VisionUpdateTask）

タスク実行なしで、Vision scan時に自動で情報を取得・保存：

- **inventory**: ボットのインベントリ内容（メモリに自動格納）
- **nearby_items**: 近くに落ちているアイテムの座標と種類

使用コマンド:
```
/data get entity @e[tag=test1,limit=1] Inventory
/execute as @e[tag=test1,limit=1] run data get entity @n[type=item] Pos
/execute as @e[tag=test1,limit=1] run data get entity @n[type=item] Item
```

### 3. 複数タスク生成対応（AIServerClient）

AIが1回の応答で複数のタスクを生成可能に：

```json
{
  "new_tasks": [
    {"type": "MINE_WOOD", "parameters": {"x": -20, "y": 64, "z": 5}},
    {"type": "MOVE_TO", "parameters": {"x": -25, "y": 64, "z": 10}}
  ]
}
```

### 4. 自律行動プロンプト（AIServerClient）

プレイヤー指示を待たず、自分で判断して行動するよう指示：

**行動優先順位**:
1. 近くにアイテムがあれば拾いに行く（MOVE_TO）
2. 近くに木(LOG)があれば掘る（MINE_WOOD）
3. 近くに石(STONE)や鉱石(ORE)があれば掘る（MINE_STONE）
4. 何もなければランダムに移動して探索
5. たまにCHATで状況報告

**GET_INVENTORY/GET_POSITIONは不要に**:
- これらは自動取得されるため、タスクとして実行する必要がなくなった

### 5. BrainFileManager拡張

`getAllPendingTasks()` メソッドを追加し、複数タスクの一括取得に対応。

## ファイル変更一覧

| ファイル | 変更種別 |
|---------|---------|
| plugin/AIminer/build.gradle | 修正 (version) |
| plugin/AIminer/src/.../executor/TaskExecutor.java | 大幅修正 |
| plugin/AIminer/src/.../vision/VisionUpdateTask.java | 大幅修正 |
| plugin/AIminer/src/.../ai/AIServerClient.java | 大幅修正 |
| plugin/AIminer/src/.../brain/BrainFileManager.java | 修正 |

## 期待される効果

1. **自律行動**: プレイヤーの指示なしで探索・採掘を継続
2. **効率的なタスク処理**: 失敗しても止まらず次のタスクへ
3. **正確な情報**: インベントリとアイテムを自動で把握
4. **多様な行動**: 木と石の両方を掘る、ランダム移動で探索

## 技術的な注意点

- マルチタスクは1秒間隔で最大3タスクを処理
- インベントリとアイテム情報はVision scan間隔（デフォルト5秒）で更新
- AIプロンプトは日本語で記述（LM Studioでの動作を想定）

## ビルド成果物

- `AIminer-1.22-SNAPSHOT.jar`
