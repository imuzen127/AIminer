# AIminer v1.23-SNAPSHOT 変更レポート

**日付**: 2025-12-02
**バージョン**: 1.22-SNAPSHOT → 1.23-SNAPSHOT

## 概要

インベントリ取得と石ブロック検出の問題を修正しました。

## 主な変更点

### 1. インベントリ取得コマンドの修正（DataCommandListener）

**問題**:
- `data get entity @e[tag=test1,limit=1] Inventory` が「Found no elements matching Inventory」エラーを返していた
- ゾンビピグリンの標準NBTには`Inventory`フィールドが存在しない

**解決**:
- カスタムNBT `data.Inventory` にアクセスするよう修正

```java
// 修正前
String command = String.format("data get entity @e[tag=%s,limit=1] Inventory", botTag);

// 修正後
String command = String.format("data get entity @e[tag=%s,limit=1] data.Inventory", botTag);
```

### 2. 石ブロック検出の強化（VisionScanner）

**問題**:
- STONEがIMPORTANT_BLOCKSに含まれておらず、normalBlocksとして扱われていた
- 結果として5ブロックしか検出されなかった

**解決**:
- STONE、COBBLESTONE、DEEPSLATE等をIMPORTANT_BLOCKSに追加

```java
private static final Set<Material> IMPORTANT_BLOCKS = EnumSet.of(
    // 木材系
    Material.OAK_LOG, Material.SPRUCE_LOG, Material.BIRCH_LOG,
    Material.JUNGLE_LOG, Material.ACACIA_LOG, Material.DARK_OAK_LOG,
    Material.CHERRY_LOG, Material.MANGROVE_LOG,
    // 石系（MINE_STONEで掘る対象）★追加
    Material.STONE, Material.COBBLESTONE, Material.DEEPSLATE,
    Material.COBBLED_DEEPSLATE, Material.ANDESITE, Material.DIORITE, Material.GRANITE,
    // 鉱石系
    Material.COAL_ORE, Material.IRON_ORE, ...
);
```

## ファイル変更一覧

| ファイル | 変更種別 |
|---------|---------|
| plugin/AIminer/build.gradle | 修正 (version) |
| plugin/AIminer/src/.../listener/DataCommandListener.java | 修正 |
| plugin/AIminer/src/.../vision/VisionScanner.java | 修正 |

## 期待される効果

1. **正確なインベントリ検出**: カスタムNBT `data.Inventory` から正しくインベントリ情報を取得
2. **石ブロックの検出強化**: STONE、COBBLESTONE等が優先的に検出され、MINE_STONEタスクが適切に生成される
3. **ブロック検出数の増加**: IMPORTANT_BLOCKS制限（最大30件）により、より多くの石ブロックが報告される

## 技術的な注意点

- インベントリはカスタムNBTパス `data.Inventory` を使用
- 石系ブロックは7種類追加（STONE, COBBLESTONE, DEEPSLATE, COBBLED_DEEPSLATE, ANDESITE, DIORITE, GRANITE）

## ビルド成果物

- `AIminer-1.23-SNAPSHOT.jar`
